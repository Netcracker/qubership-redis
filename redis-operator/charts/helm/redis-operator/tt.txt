---
# Source: redis-operator/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
---
# Source: redis-operator/templates/cluster-replicator/project-configuration-cm.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: project-configuration
  labels:
    managedBy: cluster-replicator
data:
  replicate: |
    exclude:
      - entity: "deployment.apps/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-redis-operator"
              - "redis-monitoring-agent"
      - entity: "service/v1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.clusterIP"
          - type: "RemoveField"
            jsonPath: "$.spec.clusterIPs"
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-redis-adapter"
              - "redis-monitoring-agent"
      - entity: "secret/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.labels.owner"
            values:
              - "helm"
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-aggregator-credentials"
              - "dbaas-adapter-credentials"
      - entity: "configmap/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "kube-root-ca.crt"
              - "last-applied-configuration-info"
              - "project-configuration"
              - "redis-default-conf"
              - "redis-monitoring-agent-config"
              - "resource-profile-replicator"
              - "tests-config"
              - "hashversion"
              - "version"
              - "cdnmaplist"
      - entity: "serviceaccount/v1"
      - entity: "ingress.extensions/v1beta1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.status"
      - entity: "ingress.networking.k8s.io/v1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.status"
      - entity: "role.rbac.authorization.k8s.io/v1"
      - entity: "rolebinding.rbac.authorization.k8s.io/v1"
      - entity: "facadeservice.qubership.org/v1alpha"
      - entity: "cronjob.batch/v1beta1"
      - entity: "job.batch/v1"
      - entity: "daemonset.apps/v1"
      - entity: "statefulset.apps/v1"
      - entity: "horizontalpodautoscaler.autoscaling/v1"
---
# Source: redis-operator/templates/redis_default_conf.yaml
kind: ConfigMap
apiVersion: v1
metadata:
  name: redis-default-conf
  namespace: default
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
data:
  config: |-
    activerehashing: "yes"
    aof-load-truncated: "yes"
    aof-rewrite-incremental-fsync: "yes"
    appendfilename: '"appendonly.aof"'
    appendfsync: "no"
    appendonly: "no"
    auto-aof-rewrite-min-size: 64mb
    auto-aof-rewrite-percentage: "100"
    bind: 0.0.0.0
    client-output-buffer-limit: |-
      normal 0 0 0
      client-output-buffer-limit slave 256mb 64mb 60
      client-output-buffer-limit pubsub 32mb 8mb 60
    cluster-enabled: "no"
    daemonize: "no"
    databases: "16"
    dbfilename: dump.rdb
    dir: /var/lib/redis/data
    hash-max-ziplist-entries: "512"
    hash-max-ziplist-value: "64"
    hll-sparse-max-bytes: "3000"
    hz: "10"
    latency-monitor-threshold: "0"
    list-compress-depth: "0"
    list-max-ziplist-size: "-2"
    logfile: '""'
    loglevel: notice
    lua-time-limit: "5000"
    maxclients: "50000"
    maxmemory: 200mb
    maxmemory-policy: allkeys-lru
    maxmemory-samples: "5"
    no-appendfsync-on-rewrite: "no"
    notify-keyspace-events: '""'
    port: "6379"
    protected-mode: "yes"
    rdbchecksum: "no"
    rdbcompression: "yes"
    set-max-intset-entries: "512"
    slowlog-log-slower-than: "-1"
    slowlog-max-len: "128"
    stop-writes-on-bgsave-error: "no"
    supervised: "no"
    tcp-backlog: "511"
    tcp-keepalive: "300"
    timeout: "0"
    tls-auth-clients: "no"
    zset-max-ziplist-entries: "128"
    zset-max-ziplist-value: "64"
---
# Source: redis-operator/templates/test-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: tests-config
  labels:
    app: redis-tests
data:
  dd_images: ""
---
# Source: redis-operator/templates/cluster-replicator/cluster-replicator-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: replicator-default-replication-role
  labels:
    managedBy: cluster-replicator
rules:
  - apiGroups:
      - ""
    resources:
      - services
      - configmaps
      - secrets
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - create
      - delete
  - apiGroups:
      - apps
      - extensions
    resources:
      - deployments
      - deployments/scale
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - create
      - delete
  - apiGroups:
      - batch
    resources:
      - cronjobs
    verbs:
      - list
---
# Source: redis-operator/templates/role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
rules:
- apiGroups:
  - qubership.org
  resources:
  - '*'
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - ""
  resources:
  - pods
  - services
  - persistentvolumeclaims
  - configmaps
  - secrets
  - serviceaccounts
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - apps
  resources:
  - deployments
  - deployments/status
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - roles
  - rolebindings
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
---
# Source: redis-operator/templates/cluster-replicator/cluster-replicator-rb.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: replicator-namespace-replication-role-binding
  labels:
    managedBy: cluster-replicator
subjects:
  - kind: ServiceAccount
    name: cluster-replicator
    apiGroup: ""
    namespace: replicator-dc2
roleRef:
  kind: Role
  name: replicator-default-replication-role
  apiGroup: rbac.authorization.k8s.io
---
# Source: redis-operator/templates/role_binding.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
subjects:
- kind: ServiceAccount
  name: dbaas-redis-operator
roleRef:
  kind: Role
  name: dbaas-redis-operator
  apiGroup: rbac.authorization.k8s.io
---
# Source: redis-operator/templates/cr_and_operator.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dbaas-redis-operator
  labels:
    name: dbaas-redis-operator
    app.kubernetes.io/name: dbaas-redis-operator
    app.kubernetes.io/instance: dbaas-redis-operator
    app.kubernetes.io/version: 
    app.kubernetes.io/component: 'backend'
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
    app.kubernetes.io/technology: 'go'
spec:
  replicas: 1
  selector:
    matchLabels:
      name: dbaas-redis-operator
  template:
    metadata:
      labels:
        name: dbaas-redis-operator
        app.kubernetes.io/name: dbaas-redis-operator
        app.kubernetes.io/instance: dbaas-redis-operator
        app.kubernetes.io/version: 
        app.kubernetes.io/component: 'backend'
        app.kubernetes.io/part-of: dbaas-redis-operator
        app.kubernetes.io/managed-by: operator
        app.kubernetes.io/technology: 'go'
    spec:
      serviceAccountName: dbaas-redis-operator
      
      securityContext:
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      containers:
        - name: operator
          image: ghcr.io/netcracker/qubership-redis-operator:main
          imagePullPolicy: Always
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          env:
            - name: WATCH_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: DEPLOYMENT_VERSION
              value: "6df28b9565"
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 100m
              memory: 128Mi
          livenessProbe:
            tcpSocket:
              port: 8080
            initialDelaySeconds: 20
            timeoutSeconds: 10
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          readinessProbe:
            tcpSocket:
              port: 8080
            initialDelaySeconds: 10
            timeoutSeconds: 10
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          ports:
            - containerPort: 8080
              name: web
              protocol: TCP
---
# Source: redis-operator/templates/cr_and_operator.yaml
apiVersion: qubership.org/v2
kind: DbaasRedisAdapter
metadata:
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
    app.kubernetes.io/instance: redis-operator
    app.kubernetes.io/processed-by-operator: "redis-operator"
  name: dbaas-redis-service
spec:
  partOf: dbaas-redis-operator
  artifactDescriptorVersion: 
  managedBy: operator
  instance: dbaas-redis-operator
  deploymentVersion: "6df28b9565"

  waitTimeout: 200
  serviceAccountName: dbaas-redis-operator

  securityContext:
    fsGroup: 1001
    runAsUser: 1001
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  dbaas:
    install: true
    adapter:
      username: "dbaas-aggregator"
      secretName: dbaas-adapter-credentials
      apiVersion: v2
      createDBTimeout: 60
      supportedFeatures:
        tls: false

    aggregator:
      address: http://dbaas-aggregator.dbaas:8080
      username: "cluster-dba"
      secretName: dbaas-aggregator-credentials
      physicalDatabaseIdentifier: redis
      dbaasAggregatorRegistrationAddress: http://dbaas-aggregator.dbaas-core:8080
    tls:
      enabled: false
      privateKeyFileName: tls.key
      signedCRTFileName: tls.crt
  imagePullPolicy: Always
  redis:
    dockerImage: redis:7.4.2-alpine
    args: ["/etc/redis/redis.conf","--requirepass $(REDIS_PASSWORD)"]
    secretName: redis-credentials
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 256Mi
    parameters:
      label: redis-dbaas-adapter


  monitoringAgent:
    install: false
    dockerImage: ghcr.io/netcracker/qubership-redis-monitoring-agent:main
    metricCollector: prometheus
    resources:
      limits:
        cpu: 100m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 256Mi
    influxDB:
      host: "host"
      database: "database"
      retentionPolicy: default
      user: "admin"
      secretName: redis-monitoring-agent-client-secret

  
  vaultRegistration:
    dockerImage: banzaicloud/vault-env:1.19.0
    enabled: false

  robotTests:
    install: false
    dockerImage: ghcr.io/netcracker/qubership-redis-tests:main
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 200m
        memory: 128Mi
---
# Source: redis-operator/templates/secrets/adapter_secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: dbaas-adapter-credentials
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
  labels:
    
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
stringData:
  password: "dbaas-aggregator"
  username: "dbaas-aggregator"
type: Opaque
---
# Source: redis-operator/templates/secrets/adapter_secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: dbaas-aggregator-credentials
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
  labels:
    
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
stringData:
  password: "Bnmq5567_PO"
  username: "cluster-dba"
type: Opaque
---
# Source: redis-operator/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
---
# Source: redis-operator/templates/cluster-replicator/project-configuration-cm.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: project-configuration
  labels:
    managedBy: cluster-replicator
data:
  replicate: |
    exclude:
      - entity: "deployment.apps/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-redis-operator"
              - "redis-monitoring-agent"
      - entity: "service/v1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.clusterIP"
          - type: "RemoveField"
            jsonPath: "$.spec.clusterIPs"
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-redis-adapter"
              - "redis-monitoring-agent"
      - entity: "secret/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.labels.owner"
            values:
              - "helm"
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "dbaas-aggregator-credentials"
              - "dbaas-adapter-credentials"
      - entity: "configmap/v1"
        filters:
          - type: "IgnoreEntityByField"
            jsonPath: "$.metadata.name"
            values:
              - "kube-root-ca.crt"
              - "last-applied-configuration-info"
              - "project-configuration"
              - "redis-default-conf"
              - "redis-monitoring-agent-config"
              - "resource-profile-replicator"
              - "tests-config"
              - "hashversion"
              - "version"
              - "cdnmaplist"
      - entity: "serviceaccount/v1"
      - entity: "ingress.extensions/v1beta1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.status"
      - entity: "ingress.networking.k8s.io/v1"
        filters:
          - type: "RemoveField"
            jsonPath: "$.spec.status"
      - entity: "role.rbac.authorization.k8s.io/v1"
      - entity: "rolebinding.rbac.authorization.k8s.io/v1"
      - entity: "facadeservice.qubership.org/v1alpha"
      - entity: "cronjob.batch/v1beta1"
      - entity: "job.batch/v1"
      - entity: "daemonset.apps/v1"
      - entity: "statefulset.apps/v1"
      - entity: "horizontalpodautoscaler.autoscaling/v1"
---
# Source: redis-operator/templates/redis_default_conf.yaml
kind: ConfigMap
apiVersion: v1
metadata:
  name: redis-default-conf
  namespace: default
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
data:
  config: |-
    activerehashing: "yes"
    aof-load-truncated: "yes"
    aof-rewrite-incremental-fsync: "yes"
    appendfilename: '"appendonly.aof"'
    appendfsync: "no"
    appendonly: "no"
    auto-aof-rewrite-min-size: 64mb
    auto-aof-rewrite-percentage: "100"
    bind: 0.0.0.0
    client-output-buffer-limit: |-
      normal 0 0 0
      client-output-buffer-limit slave 256mb 64mb 60
      client-output-buffer-limit pubsub 32mb 8mb 60
    cluster-enabled: "no"
    daemonize: "no"
    databases: "16"
    dbfilename: dump.rdb
    dir: /var/lib/redis/data
    hash-max-ziplist-entries: "512"
    hash-max-ziplist-value: "64"
    hll-sparse-max-bytes: "3000"
    hz: "10"
    latency-monitor-threshold: "0"
    list-compress-depth: "0"
    list-max-ziplist-size: "-2"
    logfile: '""'
    loglevel: notice
    lua-time-limit: "5000"
    maxclients: "50000"
    maxmemory: 200mb
    maxmemory-policy: allkeys-lru
    maxmemory-samples: "5"
    no-appendfsync-on-rewrite: "no"
    notify-keyspace-events: '""'
    port: "6379"
    protected-mode: "yes"
    rdbchecksum: "no"
    rdbcompression: "yes"
    set-max-intset-entries: "512"
    slowlog-log-slower-than: "-1"
    slowlog-max-len: "128"
    stop-writes-on-bgsave-error: "no"
    supervised: "no"
    tcp-backlog: "511"
    tcp-keepalive: "300"
    timeout: "0"
    tls-auth-clients: "no"
    zset-max-ziplist-entries: "128"
    zset-max-ziplist-value: "64"
---
# Source: redis-operator/templates/test-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: tests-config
  labels:
    app: redis-tests
data:
  dd_images: ""
---
# Source: redis-operator/templates/cluster-replicator/cluster-replicator-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: replicator-default-replication-role
  labels:
    managedBy: cluster-replicator
rules:
  - apiGroups:
      - ""
    resources:
      - services
      - configmaps
      - secrets
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - create
      - delete
  - apiGroups:
      - apps
      - extensions
    resources:
      - deployments
      - deployments/scale
    verbs:
      - get
      - list
      - watch
      - patch
      - update
      - create
      - delete
  - apiGroups:
      - batch
    resources:
      - cronjobs
    verbs:
      - list
---
# Source: redis-operator/templates/role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
rules:
- apiGroups:
  - qubership.org
  resources:
  - '*'
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - ""
  resources:
  - pods
  - services
  - persistentvolumeclaims
  - configmaps
  - secrets
  - serviceaccounts
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - apps
  resources:
  - deployments
  - deployments/status
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - roles
  - rolebindings
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
  - delete
---
# Source: redis-operator/templates/cluster-replicator/cluster-replicator-rb.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: replicator-namespace-replication-role-binding
  labels:
    managedBy: cluster-replicator
subjects:
  - kind: ServiceAccount
    name: cluster-replicator
    apiGroup: ""
    namespace: replicator-dc2
roleRef:
  kind: Role
  name: replicator-default-replication-role
  apiGroup: rbac.authorization.k8s.io
---
# Source: redis-operator/templates/role_binding.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: dbaas-redis-operator
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
subjects:
- kind: ServiceAccount
  name: dbaas-redis-operator
roleRef:
  kind: Role
  name: dbaas-redis-operator
  apiGroup: rbac.authorization.k8s.io
---
# Source: redis-operator/templates/cr_and_operator.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dbaas-redis-operator
  labels:
    name: dbaas-redis-operator
    app.kubernetes.io/name: dbaas-redis-operator
    app.kubernetes.io/instance: dbaas-redis-operator
    app.kubernetes.io/version: 
    app.kubernetes.io/component: 'backend'
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
    app.kubernetes.io/technology: 'go'
spec:
  replicas: 1
  selector:
    matchLabels:
      name: dbaas-redis-operator
  template:
    metadata:
      labels:
        name: dbaas-redis-operator
        app.kubernetes.io/name: dbaas-redis-operator
        app.kubernetes.io/instance: dbaas-redis-operator
        app.kubernetes.io/version: 
        app.kubernetes.io/component: 'backend'
        app.kubernetes.io/part-of: dbaas-redis-operator
        app.kubernetes.io/managed-by: operator
        app.kubernetes.io/technology: 'go'
    spec:
      serviceAccountName: dbaas-redis-operator
      
      securityContext:
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      containers:
        - name: operator
          image: ghcr.io/netcracker/qubership-redis-operator:main
          imagePullPolicy: Always
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          env:
            - name: WATCH_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: DEPLOYMENT_VERSION
              value: "6df28b9565"
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 100m
              memory: 128Mi
          livenessProbe:
            tcpSocket:
              port: 8080
            initialDelaySeconds: 20
            timeoutSeconds: 10
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          readinessProbe:
            tcpSocket:
              port: 8080
            initialDelaySeconds: 10
            timeoutSeconds: 10
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          ports:
            - containerPort: 8080
              name: web
              protocol: TCP
---
# Source: redis-operator/templates/cr_and_operator.yaml
apiVersion: qubership.org/v2
kind: DbaasRedisAdapter
metadata:
  labels:
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/processed-by-operator: "redis-operator"
  name: dbaas-redis-service
spec:
  partOf: dbaas-redis-operator
  artifactDescriptorVersion: 
  managedBy: operator
  instance: dbaas-redis-operator
  deploymentVersion: "6df28b9565"

  waitTimeout: 200
  serviceAccountName: dbaas-redis-operator

  securityContext:
    fsGroup: 1001
    runAsUser: 1001
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  dbaas:
    install: true
    adapter:
      username: "dbaas-aggregator"
      secretName: dbaas-adapter-credentials
      apiVersion: v2
      createDBTimeout: 60
      supportedFeatures:
        tls: false

    aggregator:
      address: http://dbaas-aggregator.dbaas:8080
      username: "cluster-dba"
      secretName: dbaas-aggregator-credentials
      physicalDatabaseIdentifier: redis
      dbaasAggregatorRegistrationAddress: http://dbaas-aggregator.dbaas-core:8080
    tls:
      enabled: false
      privateKeyFileName: tls.key
      signedCRTFileName: tls.crt
  imagePullPolicy: Always
  redis:
    dockerImage: redis:7.4.2-alpine
    args: ["/etc/redis/redis.conf","--requirepass $(REDIS_PASSWORD)"]
    secretName: redis-credentials
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 256Mi
    parameters:
      label: redis-dbaas-adapter


  monitoringAgent:
    install: false
    dockerImage: ghcr.io/netcracker/qubership-redis-monitoring-agent:main
    metricCollector: prometheus
    resources:
      limits:
        cpu: 100m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 256Mi
    influxDB:
      host: "host"
      database: "database"
      retentionPolicy: default
      user: "admin"
      secretName: redis-monitoring-agent-client-secret

  
  vaultRegistration:
    dockerImage: banzaicloud/vault-env:1.19.0
    enabled: false

  robotTests:
    install: false
    dockerImage: ghcr.io/netcracker/qubership-redis-tests:main
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 200m
        memory: 128Mi
---
# Source: redis-operator/templates/secrets/adapter_secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: dbaas-adapter-credentials
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
  labels:
    
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
stringData:
  password: "dbaas-aggregator"
  username: "dbaas-aggregator"
type: Opaque
---
# Source: redis-operator/templates/secrets/adapter_secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: dbaas-aggregator-credentials
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
  labels:
    
    app.kubernetes.io/version: 
    app.kubernetes.io/part-of: dbaas-redis-operator
    app.kubernetes.io/managed-by: operator
stringData:
  password: "Bnmq5567_PO"
  username: "cluster-dba"
type: Opaque
